<!--
    Copyright © 2016 - 2020 Stefan Berg <isbeorn86+NINA@googlemail.com>

    This file is part of N.I.N.A. - Nighttime Imaging 'N' Astronomy.

    N.I.N.A. is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    N.I.N.A. is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with N.I.N.A..  If not, see http://www.gnu.org/licenses/.-->
<UserControl
    x:Class="NINA.View.Equipment.Switch.PegasusAstroUltimatePowerboxV2"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:equip="clr-namespace:NINA.View.Equipment"
    xmlns:local="clr-namespace:NINA.View.Equipment.Switch"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ninactrl="clr-namespace:NINACustomControlLibrary;assembly=NINACustomControlLibrary"
    xmlns:ns="clr-namespace:NINA.Locale"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <GroupBox
            Grid.Row="0"
            Grid.Column="0"
            Header="{ns:Loc LblUPBV2PowerPorts}">
            <GroupBox.Resources>
                <DataTemplate x:Key="Writable">
                    <GroupBox>
                        <GroupBox.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Text="{Binding Name}" />

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        FontSize="16"
                                        Text="{Binding Value}" />
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        FontSize="16"
                                        Text=" " />
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        FontSize="16"
                                        Text="Volt" />
                                </StackPanel>
                            </Grid>
                        </GroupBox.Header>

                        <StackPanel Orientation="Vertical">
                            <TextBlock FontStyle="Normal" Text="{Binding Description}" />
                            <Grid Margin="0,5,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <StackPanel
                                    Grid.Column="1"
                                    Margin="0,5,0,0"
                                    Orientation="Horizontal">
                                    <ninactrl:IntStepperControl
                                        MinWidth="100"
                                        Margin="5,0,0,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        MaxValue="{Binding Maximum}"
                                        MinValue="{Binding Minimum}"
                                        StepSize="{Binding StepSize}"
                                        Value="{Binding TargetValue, Mode=TwoWay}" />
                                    <Button
                                        Height="25"
                                        Margin="5,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        Command="{Binding Path=SwitchVM.SetSwitchValueCommand, Source={StaticResource AppVM}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="{ns:Loc LblSetNewValue}">

                                        <Path
                                            Margin="5"
                                            Data="{StaticResource CheckedCircledSVG}"
                                            Fill="{StaticResource ButtonForegroundBrush}"
                                            Stretch="Uniform" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </GroupBox>
                </DataTemplate>

                <DataTemplate x:Key="WritableBoolean">
                    <GroupBox>
                        <GroupBox.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Text="{Binding Name}" />

                                <CheckBox
                                    Grid.Column="1"
                                    MaxHeight="25"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding Value, Mode=OneWay, Converter={StaticResource DoubleToBooleanConverter}}"
                                    IsEnabled="False"
                                    Style="{StaticResource BorderlessOnOffCheckbox}" />
                            </Grid>
                        </GroupBox.Header>
                        <StackPanel Orientation="Vertical">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{ns:Loc LblUPBV2Current}" />
                                    <TextBlock VerticalAlignment="Center" Text=": " />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding CurrentAmps, StringFormat=N2}" />
                                    <TextBlock VerticalAlignment="Center" Text=" A" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{ns:Loc LblUPBV2ExcessCurrent}" />
                                    <TextBlock VerticalAlignment="Center" Text=": " />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding ExcessCurrent, Converter={StaticResource BoolToLabelConverter}, ConverterParameter=LblYes|LblNo}" />
                                </StackPanel>
                            </Grid>

                            <Grid Margin="0,5,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel
                                    Grid.Column="1"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">
                                    <CheckBox
                                        Height="25"
                                        MinWidth="100"
                                        Margin="5,0,0,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        IsChecked="{Binding TargetValue, Mode=TwoWay, Converter={StaticResource DoubleToBooleanConverter}}" />
                                    <Button
                                        Height="25"
                                        Margin="4,0,0,0"
                                        VerticalAlignment="Center"
                                        HorizontalContentAlignment="Center"
                                        Command="{Binding Path=SwitchVM.SetSwitchValueCommand, Source={StaticResource AppVM}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="{ns:Loc LblSetNewValue}">
                                        <Path
                                            Margin="5"
                                            Data="{StaticResource CheckedCircledSVG}"
                                            Fill="{StaticResource ButtonForegroundBrush}"
                                            Stretch="Uniform" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </GroupBox>
                </DataTemplate>
                <local:SwitchTemplateSelector
                    x:Key="SwitchTemplateSelector"
                    Writable="{StaticResource Writable}"
                    WritableBoolean="{StaticResource WritableBoolean}" />
            </GroupBox.Resources>
            <ItemsControl
                IsEnabled="{Binding Connected}"
                ItemTemplateSelector="{StaticResource SwitchTemplateSelector}"
                ItemsSource="{Binding PowerSwitches}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel ItemHeight="120" ItemWidth="400" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.Template>
                    <ControlTemplate TargetType="{x:Type ItemsControl}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsPresenter />
                        </ScrollViewer>
                    </ControlTemplate>
                </ItemsControl.Template>
            </ItemsControl>
        </GroupBox>
        <GroupBox
            Grid.Row="0"
            Grid.Column="1"
            Header="{ns:Loc LblUPBV2UsbPorts}">
            <GroupBox.Resources>
                <DataTemplate x:Key="WritableBoolean">
                    <GroupBox>
                        <GroupBox.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Text="{Binding Name}" />

                                <CheckBox
                                    Grid.Column="1"
                                    MaxHeight="25"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding Value, Mode=OneWay, Converter={StaticResource DoubleToBooleanConverter}}"
                                    IsEnabled="False"
                                    Style="{StaticResource BorderlessOnOffCheckbox}" />
                            </Grid>
                        </GroupBox.Header>
                        <StackPanel Orientation="Vertical">
                            <TextBlock FontStyle="Normal" Text="{Binding Description}" />

                            <Grid Margin="0,5,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel
                                    Grid.Column="1"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">
                                    <CheckBox
                                        Height="25"
                                        MinWidth="100"
                                        Margin="5,0,0,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        IsChecked="{Binding TargetValue, Mode=TwoWay, Converter={StaticResource DoubleToBooleanConverter}}" />
                                    <Button
                                        Height="25"
                                        Margin="4,0,0,0"
                                        VerticalAlignment="Center"
                                        HorizontalContentAlignment="Center"
                                        Command="{Binding Path=SwitchVM.SetSwitchValueCommand, Source={StaticResource AppVM}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="{ns:Loc LblSetNewValue}">
                                        <Path
                                            Margin="5"
                                            Data="{StaticResource CheckedCircledSVG}"
                                            Fill="{StaticResource ButtonForegroundBrush}"
                                            Stretch="Uniform" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </GroupBox>
                </DataTemplate>
                <local:SwitchTemplateSelector x:Key="SwitchTemplateSelector" WritableBoolean="{StaticResource WritableBoolean}" />
            </GroupBox.Resources>
            <ItemsControl
                IsEnabled="{Binding Connected}"
                ItemTemplateSelector="{StaticResource SwitchTemplateSelector}"
                ItemsSource="{Binding UsbSwitches}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel ItemHeight="120" ItemWidth="400" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.Template>
                    <ControlTemplate TargetType="{x:Type ItemsControl}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsPresenter />
                        </ScrollViewer>
                    </ControlTemplate>
                </ItemsControl.Template>
            </ItemsControl>
        </GroupBox>
        <GroupBox
            Grid.Row="1"
            Grid.Column="0"
            Header="{ns:Loc LblUPBV2DewHeaterPorts}">
            <GroupBox.Resources>
                <DataTemplate x:Key="Writable">
                    <GroupBox>
                        <GroupBox.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Text="{Binding Name}" />

                                <TextBlock
                                    Grid.Column="1"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Text="{Binding Value}" />
                            </Grid>
                        </GroupBox.Header>

                        <StackPanel Orientation="Vertical">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{ns:Loc LblUPBV2Current}" />
                                    <TextBlock VerticalAlignment="Center" Text=": " />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding CurrentAmps, StringFormat=N2}" />
                                    <TextBlock VerticalAlignment="Center" Text=" A" />
                                </StackPanel>
                                <StackPanel
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{ns:Loc LblUPBV2ExcessCurrent}" />
                                    <TextBlock VerticalAlignment="Center" Text=": " />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding ExcessCurrent, Converter={StaticResource BoolToLabelConverter}, ConverterParameter=LblYes|LblNo}" />
                                </StackPanel>
                                <StackPanel
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{ns:Loc LblUPBV2AutoDewControl}" />
                                    <TextBlock VerticalAlignment="Center" Text=": " />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding AutoDewOn, Converter={StaticResource BoolToLabelConverter}, ConverterParameter=LblOn|LblOff}" />
                                </StackPanel>
                            </Grid>
                            <Grid Margin="0,5,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        FontStyle="Normal"
                                        Text="{ns:Loc LblUPBV2AutoDewControl}" />
                                    <CheckBox
                                        MinWidth="60"
                                        Margin="10,5,0,0"
                                        IsChecked="{Binding AutoDewOnTarget, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel
                                    Grid.Column="1"
                                    Margin="0,5,0,0"
                                    Orientation="Horizontal">
                                    <ninactrl:IntStepperControl
                                        MinWidth="100"
                                        Margin="5,0,0,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        MaxValue="{Binding Maximum}"
                                        MinValue="{Binding Minimum}"
                                        StepSize="{Binding StepSize}"
                                        Value="{Binding TargetValue, Mode=TwoWay}" />
                                    <Button
                                        Height="25"
                                        Margin="5,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        Command="{Binding Path=SwitchVM.SetSwitchValueCommand, Source={StaticResource AppVM}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="{ns:Loc LblSetNewValue}">

                                        <Path
                                            Margin="5"
                                            Data="{StaticResource CheckedCircledSVG}"
                                            Fill="{StaticResource ButtonForegroundBrush}"
                                            Stretch="Uniform" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </GroupBox>
                </DataTemplate>

                <local:SwitchTemplateSelector x:Key="SwitchTemplateSelector" Writable="{StaticResource Writable}" />
            </GroupBox.Resources>
            <ItemsControl
                IsEnabled="{Binding Connected}"
                ItemTemplateSelector="{StaticResource SwitchTemplateSelector}"
                ItemsSource="{Binding DewHeaters}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel ItemHeight="120" ItemWidth="400" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.Template>
                    <ControlTemplate TargetType="{x:Type ItemsControl}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsPresenter />
                        </ScrollViewer>
                    </ControlTemplate>
                </ItemsControl.Template>
            </ItemsControl>
        </GroupBox>
        <GroupBox
            Grid.Row="1"
            Grid.Column="1"
            Header="{ns:Loc LblUPBV2DeviceData}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <StackPanel
                    Grid.Row="0"
                    Grid.Column="0"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2InputVoltage}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.Voltage}" />
                    <TextBlock Text="V" />
                </StackPanel>
                <StackPanel
                    Grid.Row="0"
                    Grid.Column="1"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2InputCurrent}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.Current}" />
                    <TextBlock Text="A" />
                </StackPanel>
                <StackPanel
                    Grid.Row="0"
                    Grid.Column="2"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2InputPower}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.Power}" />
                    <TextBlock Text="W" />
                </StackPanel>
                <StackPanel
                    Grid.Row="0"
                    Grid.Column="3"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2Temperature}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.Temperature}" />
                    <TextBlock Text="C" />
                </StackPanel>
                <StackPanel
                    Grid.Row="0"
                    Grid.Column="4"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2RelativeHumidity}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.Humidity}" />
                    <TextBlock Text="%" />
                </StackPanel>
                <StackPanel
                    Grid.Row="0"
                    Grid.Column="5"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2DewPoint}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.DewPoint}" />
                    <TextBlock Text="C" />
                </StackPanel>
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="0"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2AverageCurrent}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.AveragePower}" />
                    <TextBlock Text="A" />
                </StackPanel>
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="1"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2AmpereHours}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.AmpereHours}" />
                    <TextBlock Text="Ah" />
                </StackPanel>
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="2"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2WattHours}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.WattHours}" />
                    <TextBlock Text="Wh" />
                </StackPanel>
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="3"
                    Grid.ColumnSpan="3"
                    Orientation="Horizontal">
                    <TextBlock Text="{ns:Loc LblUPBV2UpTime}" />
                    <TextBlock Text=": " />
                    <TextBlock Text="{Binding DataProvider.UpTime}" />
                </StackPanel>
                <equip:PegasusAstroUltimatePowerboxV2ChartsView
                    Grid.Row="2"
                    Grid.Column="0"
                    Grid.ColumnSpan="6"
                    DataContext="{Binding}" />
            </Grid>
        </GroupBox>
    </Grid>
</UserControl>