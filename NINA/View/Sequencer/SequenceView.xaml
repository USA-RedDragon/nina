<UserControl
    x:Class="NINA.View.Sequencer.SequenceView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="clr-namespace:NINA.Utility.Behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:local="clr-namespace:NINA.View.Sequencer"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ninactrl="clr-namespace:NINACustomControlLibrary;assembly=NINACustomControlLibrary"
    xmlns:ns="clr-namespace:NINA.Locale"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.InputBindings>
        <KeyBinding
            Key="S"
            Command="{Binding SaveAsSequenceCommand}"
            Modifiers="Ctrl+Shift" />
        <KeyBinding
            Key="S"
            Command="{Binding SaveSequenceCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="O"
            Command="{Binding LoadSequenceCommand}"
            Modifiers="Ctrl" />
    </UserControl.InputBindings>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="4*" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="50" />
        </Grid.RowDefinitions>
        <!--  ******* Sequencer *******  -->
        <ScrollViewer
            Grid.RowSpan="1"
            Margin="0,0,2.5,0"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto">
            <local:SequenceRootContainerView
                x:Name="MainSequenceContainer"
                Panel.ZIndex="-10"
                DataContext="{Binding Sequencer.MainContainer, UpdateSourceTrigger=PropertyChanged}" />
        </ScrollViewer>
        <!--  ******* Available Sequence Items and Templates *******  -->
        <GridSplitter
            Grid.Column="1"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch" />
        <local:SequenceSidebar
            Grid.Column="2"
            Margin="2.5,0,0,0"
            DataContext="{Binding}" />
        <!--  ******* Sequence Buttons *******  -->

        <Border
            x:Name="TrashcanBorder"
            Grid.Row="2"
            Grid.Column="0"
            Width="80"
            Margin="5"
            HorizontalAlignment="Right"
            VerticalAlignment="Stretch"
            Background="{StaticResource TertiaryBackgroundBrush}">
            <i:Interaction.Behaviors>
                <behaviors:DragOverBehavior DragOverCenterText="{ns:Loc Lbl_Sequencer_DeleteItem}" DragOverDisplayAnchor="Left" />
                <behaviors:DropIntoBehavior OnDropCommand="{Binding DetachCommand}" />
            </i:Interaction.Behaviors>
            <Border.Triggers>
                <EventTrigger RoutedEvent="MouseEnter">
                    <BeginStoryboard>
                        <Storyboard Storyboard.TargetName="TrashcanBorder" Storyboard.TargetProperty="Background">
                            <ObjectAnimationUsingKeyFrames Duration="0">
                                <DiscreteObjectKeyFrame Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                            </ObjectAnimationUsingKeyFrames>
                        </Storyboard>
                    </BeginStoryboard>
                    <BeginStoryboard>
                        <Storyboard Storyboard.TargetName="TrashcanPath" Storyboard.TargetProperty="Data">
                            <ObjectAnimationUsingKeyFrames Duration="0">
                                <DiscreteObjectKeyFrame Value="{StaticResource TrashCanOpenSVG}" />
                            </ObjectAnimationUsingKeyFrames>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
                <EventTrigger RoutedEvent="MouseLeave">
                    <BeginStoryboard>
                        <Storyboard Storyboard.TargetName="TrashcanBorder" Storyboard.TargetProperty="Background">
                            <ObjectAnimationUsingKeyFrames Duration="0">
                                <DiscreteObjectKeyFrame Value="{StaticResource TertiaryBackgroundBrush}" />
                            </ObjectAnimationUsingKeyFrames>
                        </Storyboard>
                    </BeginStoryboard>
                    <BeginStoryboard>
                        <Storyboard Storyboard.TargetName="TrashcanPath" Storyboard.TargetProperty="Data">
                            <ObjectAnimationUsingKeyFrames Duration="0">
                                <DiscreteObjectKeyFrame Value="{StaticResource TrashCanSVG}" />
                            </ObjectAnimationUsingKeyFrames>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Border.Triggers>
            <Path
                x:Name="TrashcanPath"
                Grid.Column="0"
                Width="20"
                Height="20"
                Margin="0,0,0,0"
                Data="{StaticResource TrashCanSVG}"
                Fill="{StaticResource ButtonForegroundBrush}"
                Stretch="Uniform" />
        </Border>

        <StackPanel
            Grid.Row="1"
            Grid.Column="0"
            HorizontalAlignment="Left"
            Orientation="Horizontal">
            <Button
                Width="80"
                Margin="5"
                Command="{Binding SaveAsSequenceCommand}">
                <Button.ToolTip>
                    <ToolTip ToolTipService.ShowOnDisabled="True">
                        <TextBlock Text="{ns:Loc Lbl_Sequencer_SaveAsSequence_Tooltip}" />
                    </ToolTip>
                </Button.ToolTip>
                <Path
                    Margin="5"
                    Data="{StaticResource SaveAsSVG}"
                    Fill="{StaticResource ButtonForegroundBrush}"
                    Stretch="Uniform" />
            </Button>
            <Button
                Width="80"
                Margin="5"
                Command="{Binding SaveSequenceCommand}"
                IsEnabled="{Binding SavePath, Converter={StaticResource InverseNullToBooleanConverter}}">
                <Button.ToolTip>
                    <ToolTip ToolTipService.ShowOnDisabled="True">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{ns:Loc Lbl_Sequencer_SaveSequence_Tooltip}" />
                            <TextBlock Text=" " />
                            <TextBlock Text="{Binding SavePath}" />
                        </StackPanel>
                    </ToolTip>
                </Button.ToolTip>
                <Path
                    Margin="5"
                    Data="{StaticResource SaveSVG}"
                    Fill="{StaticResource ButtonForegroundBrush}"
                    Stretch="Uniform" />
            </Button>
            <Button
                Width="80"
                Margin="5"
                Command="{Binding LoadSequenceCommand}">
                <Button.ToolTip>
                    <ToolTip ToolTipService.ShowOnDisabled="True">
                        <TextBlock Text="{ns:Loc Lbl_Sequencer_LoadSequence_Tooltip}" />
                    </ToolTip>
                </Button.ToolTip>
                <Path
                    Margin="5"
                    Data="{StaticResource LoadSVG}"
                    Fill="{StaticResource ButtonForegroundBrush}"
                    Stretch="Uniform" />
            </Button>
        </StackPanel>

        <Grid
            Grid.Row="1"
            Grid.Column="2"
            MinWidth="300"
            Margin="5,5,15,5"
            HorizontalAlignment="Stretch"
            DockPanel.Dock="Right">
            <Grid>
                <ninactrl:AsyncProcessButton
                    ButtonForegroundBrush="{StaticResource ButtonForegroundBrush}"
                    ButtonImage="{StaticResource PlaySVG}"
                    CancelButtonImage="{StaticResource CancelSVG}"
                    CancelCommand="{Binding CancelSequenceCommand}"
                    Command="{Binding StartSequenceCommand}"
                    LoadingImageBrush="{StaticResource PrimaryBrush}"
                    ToolTip="{ns:Loc LblTooltipStartSequence}" />
            </Grid>
        </Grid>
    </Grid>
</UserControl>