<UserControl x:Class="NINA.View.MeridianFlipView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NINA.View"
             xmlns:ns="clr-namespace:NINA.Locale"
             mc:Ignorable="d" Background="{StaticResource BackgroundBrush}"
             xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
             d:DesignHeight="300" d:DesignWidth="300">
    <UserControl.Resources>
        <CollectionViewSource Source="{Binding PlateSolveResultList}" x:Key="GridItems">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="SolveTime" Direction="Descending"/>
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
        
        <DataTemplate x:Key="RecenterTemplate">
            <StackPanel Orientation="Horizontal" DataContext="{Binding RelativeSource={RelativeSource AncestorType={x:Type UserControl}}, Path=DataContext}">                
                <TextBlock Text="{Binding Status}" FontSize="36" VerticalAlignment="Center"/>              
            </StackPanel>
        </DataTemplate>

        
        <DataTemplate x:Key="PassMeridianTemplate">
            <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType={x:Type UserControl}}, Path=DataContext.RemainingTime, StringFormat={}{0:hh}:{0:mm}:{0:ss}, FallbackValue=00:00}" 
                       HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="36"/>
        </DataTemplate>

        <DataTemplate x:Key="FlipDataTemplate">
            <Grid DataContext="{Binding RelativeSource={RelativeSource AncestorType={x:Type UserControl}}, Path=DataContext}">
                <TextBlock Text="{Binding Status}" FontSize="36" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="SettleDataTemplate">
            <Grid DataContext="{Binding RelativeSource={RelativeSource AncestorType={x:Type UserControl}}, Path=DataContext}">
                <TextBlock Text="{Binding Status}" FontSize="36" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>         
        </DataTemplate>

        

        <!-- Default DataTemplate -->
        <DataTemplate x:Key="DefaultTemplate">
            <Grid DataContext="{Binding RelativeSource={RelativeSource AncestorType={x:Type UserControl}}, Path=DataContext}">
                <TextBlock Text="{Binding Status}" FontSize="36" VerticalAlignment="Center" HorizontalAlignment="Center"/>
            </Grid>
        </DataTemplate>

        <local:MeridianFlipDataTemplateSelector x:Key="templateSelector"
              RecenterTemplate="{StaticResource RecenterTemplate}"
              PassMeridianTemplate="{StaticResource PassMeridianTemplate}" 
              FlipDataTemplate="{StaticResource FlipDataTemplate}" 
              SettleTemplate="{StaticResource SettleDataTemplate}" 
              DefaultTemplate="{StaticResource DefaultTemplate}"/>
        
    </UserControl.Resources>
    <Border BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
        <Grid>
            <TabControl ItemsSource="{Binding Steps}" SelectedItem="{Binding Steps.ActiveStep}" ContentTemplateSelector="{StaticResource templateSelector}" Margin="-5 0 0 0" >            
                <TabControl.Style>                
                    <Style TargetType="TabControl">
                        <Setter Property="Background" Value="{StaticResource BackgroundBrush}" />
                        <Setter Property="ItemContainerStyle">
                            <Setter.Value>
                                <Style TargetType="TabItem">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TabItem">
                                                <Grid Width="200" IsHitTestVisible="False">
                                                    <Polygon x:Name="PART_Polygon" Fill="{StaticResource ButtonBackgroundBrush}" Points="0,0 10,0 12,5 10,10 0,10 2,5 0,0" Stretch="Fill" Margin="-38 0 0 0"/>
                                                    <StackPanel Orientation="Horizontal" Background="Transparent" HorizontalAlignment="Center">
                                                        <TextBlock Text="{Binding Title}" Foreground="{StaticResource ButtonForegroundBrush}" VerticalAlignment="Center" />
                                                        <Path x:Name="PART_Checked" Margin="5" Width="25" Height="25" 
                                                              Fill="{StaticResource ButtonForegroundBrush}" Data="{StaticResource CheckedCircledSVG}" Stretch="Uniform" 
                                                              Visibility="{Binding Finished, Converter={StaticResource BooleanToVisibilityHiddenConverter}}"/>
                                                    </StackPanel>
                                                </Grid>
                                                <ControlTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding Finished}" Value="True">
                                                        <Setter TargetName="PART_Polygon" Property="Fill" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                    </DataTrigger>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="PART_Polygon" Property="Fill" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Style>
            </TabControl>
        </Grid>
    </Border>
</UserControl>
